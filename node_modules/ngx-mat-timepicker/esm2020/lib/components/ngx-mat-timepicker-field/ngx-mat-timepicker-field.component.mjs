import { ChangeDetectionStrategy, Component, EventEmitter, Input, Output, ViewEncapsulation } from "@angular/core";
import { NG_VALUE_ACCESSOR } from "@angular/forms";
import { NgxMatTimepickerService } from "../../services/ngx-mat-timepicker.service";
import { NgxMatTimepickerPeriods } from "../../models/ngx-mat-timepicker-periods.enum";
import { NgxMatTimepickerUnits } from "../../models/ngx-mat-timepicker-units.enum";
import { NgxMatTimepickerAdapter } from "../../services/ngx-mat-timepicker-adapter";
import { NgxMatTimepickerUtils } from "../../utils/ngx-mat-timepicker.utils";
import { Subject } from "rxjs";
import { distinctUntilChanged, map, takeUntil, tap } from "rxjs/operators";
import * as i0 from "@angular/core";
import * as i1 from "../../services/ngx-mat-timepicker.service";
import * as i2 from "../../services/ngx-mat-timepicker-locale.service";
import * as i3 from "@angular/common";
import * as i4 from "@angular/forms";
import * as i5 from "@angular/material/form-field";
import * as i6 from "@angular/material/select";
import * as i7 from "@angular/material/core";
import * as i8 from "@angular/material/icon";
import * as i9 from "../ngx-mat-timepicker/ngx-mat-timepicker.component";
import * as i10 from "../ngx-mat-timepicker-toggle/ngx-mat-timepicker-toggle.component";
import * as i11 from "../../directives/ngx-mat-timepicker-toggle-icon.directive";
import * as i12 from "../ngx-mat-timepicker-control/ngx-mat-timepicker-control.component";
export class NgxMatTimepickerFieldComponent {
    constructor(_timepickerService, _timepickerLocaleSrv) {
        this._timepickerService = _timepickerService;
        this._timepickerLocaleSrv = _timepickerLocaleSrv;
        this.maxHour = 12;
        this.minHour = 1;
        this.period = NgxMatTimepickerPeriods.AM;
        this.periods = [
            NgxMatTimepickerPeriods.AM,
            NgxMatTimepickerPeriods.PM
        ];
        this.timeChanged = new EventEmitter();
        this.timeUnit = NgxMatTimepickerUnits;
        this._color = "primary";
        this._floatLabel = "auto";
        this._format = 12;
        this._isFirstTimeChange = true;
        this._subsCtrl$ = new Subject();
        this._onChange = () => {
        };
    }
    get color() {
        return this._color;
    }
    set color(newValue) {
        this._color = newValue;
    }
    get defaultTime() {
        return this._defaultTime;
    }
    set defaultTime(val) {
        this._defaultTime = val;
        this._isDefaultTime = !!val;
    }
    get floatLabel() {
        return this._floatLabel;
    }
    set floatLabel(newValue) {
        this._floatLabel = newValue;
    }
    get format() {
        return this._format;
    }
    set format(value) {
        this._format = NgxMatTimepickerAdapter.isTwentyFour(value) ? 24 : 12;
        this.minHour = this._format === 12 ? 1 : 0;
        this.maxHour = this._format === 12 ? 12 : 23;
        this.hoursList = NgxMatTimepickerUtils.getHours(this._format);
        const isDynamicallyChanged = value && (this._previousFormat && this._previousFormat !== this._format);
        if (isDynamicallyChanged) {
            this._updateTime(this.timepickerTime);
        }
        this._previousFormat = this._format;
    }
    get max() {
        return this._max;
    }
    set max(value) {
        if (typeof value === "string") {
            this._max = NgxMatTimepickerAdapter.parseTime(value, { locale: this._locale, format: this.format });
            return;
        }
        this._max = value;
    }
    get min() {
        return this._min;
    }
    set min(value) {
        if (typeof value === "string") {
            this._min = NgxMatTimepickerAdapter.parseTime(value, { locale: this._locale, format: this.format });
            return;
        }
        this._min = value;
    }
    get _locale() {
        return this._timepickerLocaleSrv.locale;
    }
    changeHour(hour) {
        this._timepickerService.hour = this.hoursList.find(h => h.time === hour);
        this._changeTime();
    }
    changeMinute(minute) {
        this._timepickerService.minute = this.minutesList.find(m => m.time === minute);
        this._changeTime();
    }
    changePeriod(event) {
        this._timepickerService.period = event.value;
        this._changeTime();
    }
    ngOnDestroy() {
        this._subsCtrl$.next();
        this._subsCtrl$.complete();
    }
    ngOnInit() {
        this._initTime(this.defaultTime);
        this.hoursList = NgxMatTimepickerUtils.getHours(this._format);
        this.minutesList = NgxMatTimepickerUtils.getMinutes();
        this.isTimeRangeSet = !!(this.min || this.max);
        this.hour$ = this._timepickerService.selectedHour.pipe(tap((clockTime) => this._selectedHour = clockTime?.time), map(this._changeDefaultTimeValue.bind(this)), tap(() => this.isTimeRangeSet && this._updateAvailableMinutes()));
        this.minute$ = this._timepickerService.selectedMinute.pipe(map(this._changeDefaultTimeValue.bind(this)), tap(() => this._isFirstTimeChange = false));
        if (this.format === 12) {
            this._timepickerService.selectedPeriod.pipe(distinctUntilChanged(), tap((period) => this.period = period), tap(period => this.isChangePeriodDisabled = this._isPeriodDisabled(period)), takeUntil(this._subsCtrl$)).subscribe(() => this.isTimeRangeSet && this._updateAvailableTime());
        }
    }
    onTimeSet(time) {
        this._updateTime(time);
        this._emitLocalTimeChange(time);
    }
    registerOnChange(fn) {
        this._onChange = fn;
    }
    registerOnTouched(_fn_) {
    }
    setDisabledState(isDisabled) {
        this.disabled = isDisabled;
    }
    writeValue(val) {
        if (val) {
            this._initTime(val);
        }
        else {
            this._resetTime();
        }
    }
    _changeDefaultTimeValue(clockFaceTime) {
        if (!this._isDefaultTime && this._isFirstTimeChange) {
            return { ...clockFaceTime, time: null };
        }
        return clockFaceTime;
    }
    _changeTime() {
        const time = this._timepickerService.getFullTime(this.format);
        this.timepickerTime = time;
        this._emitLocalTimeChange(time);
    }
    _emitLocalTimeChange(time) {
        const localTime = NgxMatTimepickerAdapter.toLocaleTimeString(time, { format: this.format, locale: this._locale });
        this._onChange(localTime);
        this.timeChanged.emit(localTime);
    }
    _initTime(time) {
        const isDefaultTimeAvailable = NgxMatTimepickerAdapter
            .isTimeAvailable(time, this.min, this.max, "minutes", null, this.format);
        if (!isDefaultTimeAvailable) {
            if (this.min) {
                this._updateTime(NgxMatTimepickerAdapter.fromDateTimeToString(this.min, this.format));
                return;
            }
            if (this.max) {
                this._updateTime(NgxMatTimepickerAdapter.fromDateTimeToString(this.max, this.format));
                return;
            }
        }
        this._updateTime(time);
    }
    _isPeriodDisabled(period) {
        return NgxMatTimepickerUtils.disableHours(NgxMatTimepickerUtils.getHours(12), {
            min: this.min,
            max: this.max,
            format: 12,
            period: period === NgxMatTimepickerPeriods.AM ? NgxMatTimepickerPeriods.PM : NgxMatTimepickerPeriods.AM
        }).every(time => time.disabled);
    }
    _resetTime() {
        this._timepickerService.hour = { angle: 0, time: null };
        this._timepickerService.minute = { angle: 0, time: null };
    }
    _updateAvailableHours() {
        this.hoursList = NgxMatTimepickerUtils.disableHours(this.hoursList, {
            min: this.min,
            max: this.max,
            format: this.format,
            period: this.period
        });
    }
    _updateAvailableMinutes() {
        this.minutesList = NgxMatTimepickerUtils.disableMinutes(this.minutesList, this._selectedHour, {
            min: this.min,
            max: this.max,
            format: this.format,
            period: this.period
        });
    }
    _updateAvailableTime() {
        this._updateAvailableHours();
        if (this._selectedHour) {
            this._updateAvailableMinutes();
        }
    }
    _updateTime(time) {
        if (time) {
            const formattedTime = NgxMatTimepickerAdapter.formatTime(time, { locale: this._locale, format: this.format });
            this._timepickerService.setDefaultTimeIfAvailable(formattedTime, this.min, this.max, this.format);
            this.timepickerTime = formattedTime;
        }
    }
}
NgxMatTimepickerFieldComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.0.1", ngImport: i0, type: NgxMatTimepickerFieldComponent, deps: [{ token: i1.NgxMatTimepickerService }, { token: i2.NgxMatTimepickerLocaleService }], target: i0.ɵɵFactoryTarget.Component });
NgxMatTimepickerFieldComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.0.1", type: NgxMatTimepickerFieldComponent, selector: "ngx-mat-timepicker-field", inputs: { color: "color", defaultTime: "defaultTime", floatLabel: "floatLabel", format: "format", max: "max", min: "min", cancelBtnTmpl: "cancelBtnTmpl", confirmBtnTmpl: "confirmBtnTmpl", controlOnly: "controlOnly", disabled: "disabled", toggleIcon: "toggleIcon" }, outputs: { timeChanged: "timeChanged" }, providers: [
        NgxMatTimepickerService,
        {
            provide: NG_VALUE_ACCESSOR,
            useExisting: NgxMatTimepickerFieldComponent,
            multi: true
        }
    ], ngImport: i0, template: "<div class=\"ngx-mat-timepicker\"\r\n     [ngClass]=\"{'ngx-mat-timepicker--disabled': disabled}\">\r\n    <ngx-mat-timepicker-time-control\r\n            class=\"ngx-mat-timepicker__control--first\"\r\n            [color]=\"color\"\r\n            [floatLabel]=\"floatLabel\"\r\n            [placeholder]=\"'HH'\"\r\n            [time]=\"(hour$ | async)?.time\"\r\n            [min]=\"minHour\"\r\n            [max]=\"maxHour\"\r\n            [timeUnit]=\"timeUnit.HOUR\"\r\n            [disabled]=\"disabled\"\r\n            [timeList]=\"hoursList\"\r\n            [preventTyping]=\"isTimeRangeSet\"\r\n            (timeChanged)=\"changeHour($event)\"></ngx-mat-timepicker-time-control>\r\n    <span class=\"separator-colon ngx-mat-timepicker__control--second\">:</span>\r\n    <ngx-mat-timepicker-time-control\r\n            class=\"ngx-mat-timepicker__control--third\"\r\n            [color]=\"color\"\r\n            [floatLabel]=\"floatLabel\"\r\n            [placeholder]=\"'MM'\"\r\n            [time]=\"(minute$ | async)?.time\"\r\n            [min]=\"0\"\r\n            [max]=\"59\"\r\n            [timeUnit]=\"timeUnit.MINUTE\"\r\n            [disabled]=\"disabled\"\r\n            [timeList]=\"minutesList\"\r\n            [preventTyping]=\"isTimeRangeSet\"\r\n            (timeChanged)=\"changeMinute($event)\"></ngx-mat-timepicker-time-control>\r\n    <mat-form-field class=\"period-select ngx-mat-timepicker__control--forth\"\r\n                    *ngIf=\"format !== 24\"\r\n                    [color]=\"color\">\r\n        <mat-select [disabled]=\"disabled || isChangePeriodDisabled\"\r\n                    (selectionChange)=\"changePeriod($event)\"\r\n                    [ngModel]=\"period\">\r\n            <mat-option *ngFor=\"let option of periods\"\r\n                        [value]=\"option\">{{option}}</mat-option>\r\n        </mat-select>\r\n    </mat-form-field>\r\n    <ngx-mat-timepicker-toggle\r\n            class=\"ngx-mat-timepicker__toggle\"\r\n            *ngIf=\"!controlOnly\"\r\n            [for]=\"timepicker\"\r\n            [disabled]=\"disabled\">\r\n        <span ngxMatTimepickerToggleIcon>\r\n            <ng-container *ngTemplateOutlet=\"toggleIcon || defaultIcon\"></ng-container>\r\n        </span>\r\n    </ngx-mat-timepicker-toggle>\r\n</div>\r\n<ngx-mat-timepicker\r\n        [color]=\"color\"\r\n        [min]=\"min\"\r\n        [max]=\"max\"\r\n        [defaultTime]=\"timepickerTime\"\r\n        [format]=\"format\"\r\n        [cancelBtnTmpl]=\"cancelBtnTmpl\"\r\n        [confirmBtnTmpl]=\"confirmBtnTmpl\"\r\n        (timeSet)=\"onTimeSet($event)\"\r\n        #timepicker></ngx-mat-timepicker>\r\n\r\n<ng-template #defaultIcon>\r\n    <mat-icon>watch_later</mat-icon>\r\n</ng-template>\r\n", styles: [".ngx-mat-timepicker{display:flex;align-items:center;height:100%}.ngx-mat-timepicker--disabled{background:rgba(0,0,0,.07);pointer-events:none}.ngx-mat-timepicker .separator-colon{margin-left:5px;margin-right:5px}.ngx-mat-timepicker .period-select{width:60px;min-width:60px;margin-left:8px;text-align:center}.ngx-mat-timepicker__control--first{order:1}.ngx-mat-timepicker__control--second{order:2}.ngx-mat-timepicker__control--third{order:3}.ngx-mat-timepicker__control--forth{order:4}.ngx-mat-timepicker__toggle{order:4;margin-bottom:1.5em;margin-left:4px}.ngx-mat-timepicker__toggle span.mat-button-wrapper{font-size:24px}\n"], dependencies: [{ kind: "directive", type: i3.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: i3.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i3.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet", "ngTemplateOutletInjector"] }, { kind: "directive", type: i4.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i4.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }, { kind: "component", type: i5.MatFormField, selector: "mat-form-field", inputs: ["hideRequiredMarker", "color", "floatLabel", "appearance", "subscriptSizing", "hintLabel"], exportAs: ["matFormField"] }, { kind: "component", type: i6.MatSelect, selector: "mat-select", inputs: ["disabled", "disableRipple", "tabIndex"], exportAs: ["matSelect"] }, { kind: "component", type: i7.MatOption, selector: "mat-option", exportAs: ["matOption"] }, { kind: "component", type: i8.MatIcon, selector: "mat-icon", inputs: ["color", "inline", "svgIcon", "fontSet", "fontIcon"], exportAs: ["matIcon"] }, { kind: "component", type: i9.NgxMatTimepickerComponent, selector: "ngx-mat-timepicker", inputs: ["appendToInput", "color", "enableKeyboardInput", "format", "minutesGap", "cancelBtnTmpl", "confirmBtnTmpl", "defaultTime", "disableAnimation", "editableHintTmpl", "hoursOnly", "isEsc", "max", "min", "preventOverlayClick", "timepickerClass"], outputs: ["closed", "hourSelected", "opened", "timeChanged", "timeSet"] }, { kind: "component", type: i10.NgxMatTimepickerToggleComponent, selector: "ngx-mat-timepicker-toggle", inputs: ["disabled", "for"] }, { kind: "directive", type: i11.NgxMatTimepickerToggleIconDirective, selector: "[ngxMatTimepickerToggleIcon]" }, { kind: "component", type: i12.NgxMatTimepickerControlComponent, selector: "ngx-mat-timepicker-time-control", inputs: ["color", "disabled", "floatLabel", "max", "min", "placeholder", "preventTyping", "time", "timeList", "timeUnit"], outputs: ["timeChanged"] }, { kind: "pipe", type: i3.AsyncPipe, name: "async" }], changeDetection: i0.ChangeDetectionStrategy.OnPush, encapsulation: i0.ViewEncapsulation.None });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.0.1", ngImport: i0, type: NgxMatTimepickerFieldComponent, decorators: [{
            type: Component,
            args: [{ selector: "ngx-mat-timepicker-field", providers: [
                        NgxMatTimepickerService,
                        {
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: NgxMatTimepickerFieldComponent,
                            multi: true
                        }
                    ], changeDetection: ChangeDetectionStrategy.OnPush, encapsulation: ViewEncapsulation.None, template: "<div class=\"ngx-mat-timepicker\"\r\n     [ngClass]=\"{'ngx-mat-timepicker--disabled': disabled}\">\r\n    <ngx-mat-timepicker-time-control\r\n            class=\"ngx-mat-timepicker__control--first\"\r\n            [color]=\"color\"\r\n            [floatLabel]=\"floatLabel\"\r\n            [placeholder]=\"'HH'\"\r\n            [time]=\"(hour$ | async)?.time\"\r\n            [min]=\"minHour\"\r\n            [max]=\"maxHour\"\r\n            [timeUnit]=\"timeUnit.HOUR\"\r\n            [disabled]=\"disabled\"\r\n            [timeList]=\"hoursList\"\r\n            [preventTyping]=\"isTimeRangeSet\"\r\n            (timeChanged)=\"changeHour($event)\"></ngx-mat-timepicker-time-control>\r\n    <span class=\"separator-colon ngx-mat-timepicker__control--second\">:</span>\r\n    <ngx-mat-timepicker-time-control\r\n            class=\"ngx-mat-timepicker__control--third\"\r\n            [color]=\"color\"\r\n            [floatLabel]=\"floatLabel\"\r\n            [placeholder]=\"'MM'\"\r\n            [time]=\"(minute$ | async)?.time\"\r\n            [min]=\"0\"\r\n            [max]=\"59\"\r\n            [timeUnit]=\"timeUnit.MINUTE\"\r\n            [disabled]=\"disabled\"\r\n            [timeList]=\"minutesList\"\r\n            [preventTyping]=\"isTimeRangeSet\"\r\n            (timeChanged)=\"changeMinute($event)\"></ngx-mat-timepicker-time-control>\r\n    <mat-form-field class=\"period-select ngx-mat-timepicker__control--forth\"\r\n                    *ngIf=\"format !== 24\"\r\n                    [color]=\"color\">\r\n        <mat-select [disabled]=\"disabled || isChangePeriodDisabled\"\r\n                    (selectionChange)=\"changePeriod($event)\"\r\n                    [ngModel]=\"period\">\r\n            <mat-option *ngFor=\"let option of periods\"\r\n                        [value]=\"option\">{{option}}</mat-option>\r\n        </mat-select>\r\n    </mat-form-field>\r\n    <ngx-mat-timepicker-toggle\r\n            class=\"ngx-mat-timepicker__toggle\"\r\n            *ngIf=\"!controlOnly\"\r\n            [for]=\"timepicker\"\r\n            [disabled]=\"disabled\">\r\n        <span ngxMatTimepickerToggleIcon>\r\n            <ng-container *ngTemplateOutlet=\"toggleIcon || defaultIcon\"></ng-container>\r\n        </span>\r\n    </ngx-mat-timepicker-toggle>\r\n</div>\r\n<ngx-mat-timepicker\r\n        [color]=\"color\"\r\n        [min]=\"min\"\r\n        [max]=\"max\"\r\n        [defaultTime]=\"timepickerTime\"\r\n        [format]=\"format\"\r\n        [cancelBtnTmpl]=\"cancelBtnTmpl\"\r\n        [confirmBtnTmpl]=\"confirmBtnTmpl\"\r\n        (timeSet)=\"onTimeSet($event)\"\r\n        #timepicker></ngx-mat-timepicker>\r\n\r\n<ng-template #defaultIcon>\r\n    <mat-icon>watch_later</mat-icon>\r\n</ng-template>\r\n", styles: [".ngx-mat-timepicker{display:flex;align-items:center;height:100%}.ngx-mat-timepicker--disabled{background:rgba(0,0,0,.07);pointer-events:none}.ngx-mat-timepicker .separator-colon{margin-left:5px;margin-right:5px}.ngx-mat-timepicker .period-select{width:60px;min-width:60px;margin-left:8px;text-align:center}.ngx-mat-timepicker__control--first{order:1}.ngx-mat-timepicker__control--second{order:2}.ngx-mat-timepicker__control--third{order:3}.ngx-mat-timepicker__control--forth{order:4}.ngx-mat-timepicker__toggle{order:4;margin-bottom:1.5em;margin-left:4px}.ngx-mat-timepicker__toggle span.mat-button-wrapper{font-size:24px}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.NgxMatTimepickerService }, { type: i2.NgxMatTimepickerLocaleService }]; }, propDecorators: { color: [{
                type: Input
            }], defaultTime: [{
                type: Input
            }], floatLabel: [{
                type: Input
            }], format: [{
                type: Input
            }], max: [{
                type: Input
            }], min: [{
                type: Input
            }], cancelBtnTmpl: [{
                type: Input
            }], confirmBtnTmpl: [{
                type: Input
            }], controlOnly: [{
                type: Input
            }], disabled: [{
                type: Input
            }], timeChanged: [{
                type: Output
            }], toggleIcon: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LW1hdC10aW1lcGlja2VyLWZpZWxkLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1tYXQtdGltZXBpY2tlci9zcmMvbGliL2NvbXBvbmVudHMvbmd4LW1hdC10aW1lcGlja2VyLWZpZWxkL25neC1tYXQtdGltZXBpY2tlci1maWVsZC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtbWF0LXRpbWVwaWNrZXIvc3JjL2xpYi9jb21wb25lbnRzL25neC1tYXQtdGltZXBpY2tlci1maWVsZC9uZ3gtbWF0LXRpbWVwaWNrZXItZmllbGQuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNILHVCQUF1QixFQUN2QixTQUFTLEVBQ1QsWUFBWSxFQUNaLEtBQUssRUFHTCxNQUFNLEVBRU4saUJBQWlCLEVBQ3BCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBdUIsaUJBQWlCLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQU92RSxPQUFPLEVBQUMsdUJBQXVCLEVBQUMsTUFBTSwyQ0FBMkMsQ0FBQztBQUVsRixPQUFPLEVBQUMsdUJBQXVCLEVBQUMsTUFBTSw4Q0FBOEMsQ0FBQztBQUNyRixPQUFPLEVBQUMscUJBQXFCLEVBQUMsTUFBTSw0Q0FBNEMsQ0FBQztBQUNqRixPQUFPLEVBQUMsdUJBQXVCLEVBQUMsTUFBTSwyQ0FBMkMsQ0FBQztBQUNsRixPQUFPLEVBQUMscUJBQXFCLEVBQUMsTUFBTSxzQ0FBc0MsQ0FBQztBQUczRSxPQUFPLEVBQWEsT0FBTyxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBQ3pDLE9BQU8sRUFBQyxvQkFBb0IsRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBQyxNQUFNLGdCQUFnQixDQUFDOzs7Ozs7Ozs7Ozs7OztBQWlCekUsTUFBTSxPQUFPLDhCQUE4QjtJQTJIdkMs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Qiw4QkFBOEIsc1dBWDVCO1FBQ1AsdUJBQXVCO1FBQ3ZCO1lBQ0ksT0FBTyxFQUFFLGlCQUFpQjtZQUMxQixXQUFXLEVBQUUsOEJBQThCO1lBQzNDLEtBQUssRUFBRSxJQUFJO1NBQ2Q7S0FDSiwwQkN4Q0wsNnJGQStEQTsyRkRuQmEsOEJBQThCO2tCQWYxQyxTQUFTOytCQUNJLDBCQUEwQixhQUd6Qjt3QkFDUCx1QkFBdUI7d0JBQ3ZCOzRCQUNJLE9BQU8sRUFBRSxpQkFBaUI7NEJBQzFCLFdBQVcsZ0NBQWdDOzRCQUMzQyxLQUFLLEVBQUUsSUFBSTt5QkFDZDtxQkFDSixtQkFDZ0IsdUJBQXVCLENBQUMsTUFBTSxpQkFDaEMsaUJBQWlCLENBQUMsSUFBSTswSkFTakMsS0FBSztzQkFEUixLQUFLO2dCQVVGLFdBQVc7c0JBRGQsS0FBSztnQkFXRixVQUFVO3NCQURiLEtBQUs7Z0JBVUYsTUFBTTtzQkFEVCxLQUFLO2dCQW1CRixHQUFHO3NCQUROLEtBQUs7Z0JBZUYsR0FBRztzQkFETixLQUFLO2dCQWVOLGFBQWE7c0JBRFosS0FBSztnQkFJTixjQUFjO3NCQURiLEtBQUs7Z0JBSU4sV0FBVztzQkFEVixLQUFLO2dCQUdHLFFBQVE7c0JBQWhCLEtBQUs7Z0JBZ0JJLFdBQVc7c0JBQXBCLE1BQU07Z0JBSUUsVUFBVTtzQkFBbEIsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcclxuICAgIENvbXBvbmVudCxcclxuICAgIEV2ZW50RW1pdHRlcixcclxuICAgIElucHV0LFxyXG4gICAgT25EZXN0cm95LFxyXG4gICAgT25Jbml0LFxyXG4gICAgT3V0cHV0LFxyXG4gICAgVGVtcGxhdGVSZWYsXHJcbiAgICBWaWV3RW5jYXBzdWxhdGlvblxyXG59IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmltcG9ydCB7Q29udHJvbFZhbHVlQWNjZXNzb3IsIE5HX1ZBTFVFX0FDQ0VTU09SfSBmcm9tIFwiQGFuZ3VsYXIvZm9ybXNcIjtcclxuaW1wb3J0IHtNYXRTZWxlY3RDaGFuZ2V9IGZyb20gXCJAYW5ndWxhci9tYXRlcmlhbC9zZWxlY3RcIjtcclxuaW1wb3J0IHtUaGVtZVBhbGV0dGV9IGZyb20gXCJAYW5ndWxhci9tYXRlcmlhbC9jb3JlXCI7XHJcbmltcG9ydCB7RmxvYXRMYWJlbFR5cGV9IGZyb20gXCJAYW5ndWxhci9tYXRlcmlhbC9mb3JtLWZpZWxkXCI7XHJcbi8vXHJcbmltcG9ydCB7Tmd4TWF0VGltZXBpY2tlckxvY2FsZVNlcnZpY2V9IGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9uZ3gtbWF0LXRpbWVwaWNrZXItbG9jYWxlLnNlcnZpY2VcIjtcclxuaW1wb3J0IHtOZ3hNYXRUaW1lcGlja2VyRm9ybWF0VHlwZX0gZnJvbSBcIi4uLy4uL21vZGVscy9uZ3gtbWF0LXRpbWVwaWNrZXItZm9ybWF0LnR5cGVcIjtcclxuaW1wb3J0IHtOZ3hNYXRUaW1lcGlja2VyU2VydmljZX0gZnJvbSBcIi4uLy4uL3NlcnZpY2VzL25neC1tYXQtdGltZXBpY2tlci5zZXJ2aWNlXCI7XHJcbmltcG9ydCB7Tmd4TWF0VGltZXBpY2tlckNsb2NrRmFjZX0gZnJvbSBcIi4uLy4uL21vZGVscy9uZ3gtbWF0LXRpbWVwaWNrZXItY2xvY2stZmFjZS5pbnRlcmZhY2VcIjtcclxuaW1wb3J0IHtOZ3hNYXRUaW1lcGlja2VyUGVyaW9kc30gZnJvbSBcIi4uLy4uL21vZGVscy9uZ3gtbWF0LXRpbWVwaWNrZXItcGVyaW9kcy5lbnVtXCI7XHJcbmltcG9ydCB7Tmd4TWF0VGltZXBpY2tlclVuaXRzfSBmcm9tIFwiLi4vLi4vbW9kZWxzL25neC1tYXQtdGltZXBpY2tlci11bml0cy5lbnVtXCI7XHJcbmltcG9ydCB7Tmd4TWF0VGltZXBpY2tlckFkYXB0ZXJ9IGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9uZ3gtbWF0LXRpbWVwaWNrZXItYWRhcHRlclwiO1xyXG5pbXBvcnQge05neE1hdFRpbWVwaWNrZXJVdGlsc30gZnJvbSBcIi4uLy4uL3V0aWxzL25neC1tYXQtdGltZXBpY2tlci51dGlsc1wiO1xyXG4vL1xyXG5pbXBvcnQge0RhdGVUaW1lfSBmcm9tIFwidHMtbHV4b25cIjtcclxuaW1wb3J0IHtPYnNlcnZhYmxlLCBTdWJqZWN0fSBmcm9tIFwicnhqc1wiO1xyXG5pbXBvcnQge2Rpc3RpbmN0VW50aWxDaGFuZ2VkLCBtYXAsIHRha2VVbnRpbCwgdGFwfSBmcm9tIFwicnhqcy9vcGVyYXRvcnNcIjtcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6IFwibmd4LW1hdC10aW1lcGlja2VyLWZpZWxkXCIsXHJcbiAgICB0ZW1wbGF0ZVVybDogXCIuL25neC1tYXQtdGltZXBpY2tlci1maWVsZC5jb21wb25lbnQuaHRtbFwiLFxyXG4gICAgc3R5bGVVcmxzOiBbXCIuL25neC1tYXQtdGltZXBpY2tlci1maWVsZC5jb21wb25lbnQuc2Nzc1wiXSxcclxuICAgIHByb3ZpZGVyczogW1xyXG4gICAgICAgIE5neE1hdFRpbWVwaWNrZXJTZXJ2aWNlLFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXHJcbiAgICAgICAgICAgIHVzZUV4aXN0aW5nOiBOZ3hNYXRUaW1lcGlja2VyRmllbGRDb21wb25lbnQsXHJcbiAgICAgICAgICAgIG11bHRpOiB0cnVlXHJcbiAgICAgICAgfVxyXG4gICAgXSxcclxuICAgIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxyXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZVxyXG59KVxyXG5leHBvcnQgY2xhc3MgTmd4TWF0VGltZXBpY2tlckZpZWxkQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3ksIENvbnRyb2xWYWx1ZUFjY2Vzc29yIHtcclxuXHJcbiAgICBnZXQgY29sb3IoKTogVGhlbWVQYWxldHRlIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fY29sb3I7XHJcbiAgICB9XHJcblxyXG4gICAgQElucHV0KClcclxuICAgIHNldCBjb2xvcihuZXdWYWx1ZTogVGhlbWVQYWxldHRlKSB7XHJcbiAgICAgICAgdGhpcy5fY29sb3IgPSBuZXdWYWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgZGVmYXVsdFRpbWUoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZGVmYXVsdFRpbWU7XHJcbiAgICB9XHJcblxyXG4gICAgQElucHV0KClcclxuICAgIHNldCBkZWZhdWx0VGltZSh2YWw6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuX2RlZmF1bHRUaW1lID0gdmFsO1xyXG4gICAgICAgIHRoaXMuX2lzRGVmYXVsdFRpbWUgPSAhIXZhbDtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgZmxvYXRMYWJlbCgpOiBGbG9hdExhYmVsVHlwZSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Zsb2F0TGFiZWw7XHJcbiAgICB9XHJcblxyXG4gICAgQElucHV0KClcclxuICAgIHNldCBmbG9hdExhYmVsKG5ld1ZhbHVlOiBGbG9hdExhYmVsVHlwZSkge1xyXG4gICAgICAgIHRoaXMuX2Zsb2F0TGFiZWwgPSBuZXdWYWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgZm9ybWF0KCk6IE5neE1hdFRpbWVwaWNrZXJGb3JtYXRUeXBlIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZm9ybWF0O1xyXG4gICAgfVxyXG5cclxuICAgIEBJbnB1dCgpXHJcbiAgICBzZXQgZm9ybWF0KHZhbHVlOiBOZ3hNYXRUaW1lcGlja2VyRm9ybWF0VHlwZSkge1xyXG4gICAgICAgIHRoaXMuX2Zvcm1hdCA9IE5neE1hdFRpbWVwaWNrZXJBZGFwdGVyLmlzVHdlbnR5Rm91cih2YWx1ZSkgPyAyNCA6IDEyO1xyXG4gICAgICAgIHRoaXMubWluSG91ciA9IHRoaXMuX2Zvcm1hdCA9PT0gMTIgPyAxIDogMDtcclxuICAgICAgICB0aGlzLm1heEhvdXIgPSB0aGlzLl9mb3JtYXQgPT09IDEyID8gMTIgOiAyMztcclxuICAgICAgICB0aGlzLmhvdXJzTGlzdCA9IE5neE1hdFRpbWVwaWNrZXJVdGlscy5nZXRIb3Vycyh0aGlzLl9mb3JtYXQpO1xyXG4gICAgICAgIGNvbnN0IGlzRHluYW1pY2FsbHlDaGFuZ2VkID0gdmFsdWUgJiYgKHRoaXMuX3ByZXZpb3VzRm9ybWF0ICYmIHRoaXMuX3ByZXZpb3VzRm9ybWF0ICE9PSB0aGlzLl9mb3JtYXQpO1xyXG5cclxuICAgICAgICBpZiAoaXNEeW5hbWljYWxseUNoYW5nZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5fdXBkYXRlVGltZSh0aGlzLnRpbWVwaWNrZXJUaW1lKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fcHJldmlvdXNGb3JtYXQgPSB0aGlzLl9mb3JtYXQ7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IG1heCgpOiBEYXRlVGltZSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX21heDtcclxuICAgIH1cclxuXHJcbiAgICBASW5wdXQoKVxyXG4gICAgc2V0IG1heCh2YWx1ZTogc3RyaW5nIHwgRGF0ZVRpbWUpIHtcclxuICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX21heCA9IE5neE1hdFRpbWVwaWNrZXJBZGFwdGVyLnBhcnNlVGltZSh2YWx1ZSwge2xvY2FsZTogdGhpcy5fbG9jYWxlLCBmb3JtYXQ6IHRoaXMuZm9ybWF0fSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX21heCA9IHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBtaW4oKTogRGF0ZVRpbWUge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9taW47XHJcbiAgICB9XHJcblxyXG4gICAgQElucHV0KClcclxuICAgIHNldCBtaW4odmFsdWU6IHN0cmluZyB8IERhdGVUaW1lKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICB0aGlzLl9taW4gPSBOZ3hNYXRUaW1lcGlja2VyQWRhcHRlci5wYXJzZVRpbWUodmFsdWUsIHtsb2NhbGU6IHRoaXMuX2xvY2FsZSwgZm9ybWF0OiB0aGlzLmZvcm1hdH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLl9taW4gPSB2YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldCBfbG9jYWxlKCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RpbWVwaWNrZXJMb2NhbGVTcnYubG9jYWxlO1xyXG4gICAgfVxyXG5cclxuICAgIEBJbnB1dCgpXHJcbiAgICBjYW5jZWxCdG5UbXBsOiBUZW1wbGF0ZVJlZjxOb2RlPjtcclxuXHJcbiAgICBASW5wdXQoKVxyXG4gICAgY29uZmlybUJ0blRtcGw6IFRlbXBsYXRlUmVmPE5vZGU+O1xyXG5cclxuICAgIEBJbnB1dCgpXHJcbiAgICBjb250cm9sT25seTogYm9vbGVhbjtcclxuXHJcbiAgICBASW5wdXQoKSBkaXNhYmxlZDogYm9vbGVhbjtcclxuICAgIGhvdXIkOiBPYnNlcnZhYmxlPE5neE1hdFRpbWVwaWNrZXJDbG9ja0ZhY2U+O1xyXG5cclxuICAgIGhvdXJzTGlzdDogTmd4TWF0VGltZXBpY2tlckNsb2NrRmFjZVtdO1xyXG4gICAgaXNDaGFuZ2VQZXJpb2REaXNhYmxlZDogYm9vbGVhbjtcclxuICAgIGlzVGltZVJhbmdlU2V0OiBib29sZWFuO1xyXG4gICAgbWF4SG91ciA9IDEyO1xyXG4gICAgbWluSG91ciA9IDE7XHJcbiAgICBtaW51dGUkOiBPYnNlcnZhYmxlPE5neE1hdFRpbWVwaWNrZXJDbG9ja0ZhY2U+O1xyXG4gICAgbWludXRlc0xpc3Q6IE5neE1hdFRpbWVwaWNrZXJDbG9ja0ZhY2VbXTtcclxuICAgIHBlcmlvZDogTmd4TWF0VGltZXBpY2tlclBlcmlvZHMgPSBOZ3hNYXRUaW1lcGlja2VyUGVyaW9kcy5BTTtcclxuICAgIHBlcmlvZHM6IE5neE1hdFRpbWVwaWNrZXJQZXJpb2RzW10gPSBbXHJcbiAgICAgICAgTmd4TWF0VGltZXBpY2tlclBlcmlvZHMuQU0sXHJcbiAgICAgICAgTmd4TWF0VGltZXBpY2tlclBlcmlvZHMuUE1cclxuICAgIF07XHJcblxyXG4gICAgQE91dHB1dCgpIHRpbWVDaGFuZ2VkID0gbmV3IEV2ZW50RW1pdHRlcjxzdHJpbmc+KCk7XHJcbiAgICB0aW1lcGlja2VyVGltZTogc3RyaW5nO1xyXG5cclxuICAgIHRpbWVVbml0ID0gTmd4TWF0VGltZXBpY2tlclVuaXRzO1xyXG4gICAgQElucHV0KCkgdG9nZ2xlSWNvbjogVGVtcGxhdGVSZWY8SFRNTE9iamVjdEVsZW1lbnQ+O1xyXG5cclxuICAgIHByaXZhdGUgX2NvbG9yOiBUaGVtZVBhbGV0dGUgPSBcInByaW1hcnlcIjtcclxuICAgIHByaXZhdGUgX2RlZmF1bHRUaW1lOiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIF9mbG9hdExhYmVsOiBGbG9hdExhYmVsVHlwZSA9IFwiYXV0b1wiO1xyXG4gICAgcHJpdmF0ZSBfZm9ybWF0OiBOZ3hNYXRUaW1lcGlja2VyRm9ybWF0VHlwZSA9IDEyO1xyXG4gICAgcHJpdmF0ZSBfaXNEZWZhdWx0VGltZTogYm9vbGVhbjtcclxuICAgIHByaXZhdGUgX2lzRmlyc3RUaW1lQ2hhbmdlOiBib29sZWFuID0gdHJ1ZTtcclxuICAgIHByaXZhdGUgX21heDogRGF0ZVRpbWU7XHJcbiAgICBwcml2YXRlIF9taW46IERhdGVUaW1lO1xyXG4gICAgcHJpdmF0ZSBfcHJldmlvdXNGb3JtYXQ6IG51bWJlcjtcclxuICAgIHByaXZhdGUgX3NlbGVjdGVkSG91cjogbnVtYmVyO1xyXG4gICAgcHJpdmF0ZSBfc3Vic0N0cmwkOiBTdWJqZWN0PHZvaWQ+ID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIF90aW1lcGlja2VyU2VydmljZTogTmd4TWF0VGltZXBpY2tlclNlcnZpY2UsXHJcbiAgICAgICAgICAgICAgICBwcml2YXRlIF90aW1lcGlja2VyTG9jYWxlU3J2OiBOZ3hNYXRUaW1lcGlja2VyTG9jYWxlU2VydmljZSkge1xyXG4gICAgfVxyXG5cclxuICAgIGNoYW5nZUhvdXIoaG91cjogbnVtYmVyKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5fdGltZXBpY2tlclNlcnZpY2UuaG91ciA9IHRoaXMuaG91cnNMaXN0LmZpbmQoaCA9PiBoLnRpbWUgPT09IGhvdXIpO1xyXG4gICAgICAgIHRoaXMuX2NoYW5nZVRpbWUoKTtcclxuICAgIH1cclxuXHJcbiAgICBjaGFuZ2VNaW51dGUobWludXRlOiBudW1iZXIpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLl90aW1lcGlja2VyU2VydmljZS5taW51dGUgPSB0aGlzLm1pbnV0ZXNMaXN0LmZpbmQobSA9PiBtLnRpbWUgPT09IG1pbnV0ZSk7XHJcbiAgICAgICAgdGhpcy5fY2hhbmdlVGltZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGNoYW5nZVBlcmlvZChldmVudDogTWF0U2VsZWN0Q2hhbmdlKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5fdGltZXBpY2tlclNlcnZpY2UucGVyaW9kID0gZXZlbnQudmFsdWUgYXMgTmd4TWF0VGltZXBpY2tlclBlcmlvZHM7XHJcbiAgICAgICAgdGhpcy5fY2hhbmdlVGltZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuX3N1YnNDdHJsJC5uZXh0KCk7XHJcbiAgICAgICAgdGhpcy5fc3Vic0N0cmwkLmNvbXBsZXRlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgdGhpcy5faW5pdFRpbWUodGhpcy5kZWZhdWx0VGltZSk7XHJcblxyXG4gICAgICAgIHRoaXMuaG91cnNMaXN0ID0gTmd4TWF0VGltZXBpY2tlclV0aWxzLmdldEhvdXJzKHRoaXMuX2Zvcm1hdCk7XHJcbiAgICAgICAgdGhpcy5taW51dGVzTGlzdCA9IE5neE1hdFRpbWVwaWNrZXJVdGlscy5nZXRNaW51dGVzKCk7XHJcbiAgICAgICAgdGhpcy5pc1RpbWVSYW5nZVNldCA9ICEhKHRoaXMubWluIHx8IHRoaXMubWF4KTtcclxuXHJcbiAgICAgICAgdGhpcy5ob3VyJCA9IHRoaXMuX3RpbWVwaWNrZXJTZXJ2aWNlLnNlbGVjdGVkSG91ci5waXBlKFxyXG4gICAgICAgICAgICB0YXAoKGNsb2NrVGltZTogTmd4TWF0VGltZXBpY2tlckNsb2NrRmFjZSkgPT4gdGhpcy5fc2VsZWN0ZWRIb3VyID0gY2xvY2tUaW1lPy50aW1lKSxcclxuICAgICAgICAgICAgbWFwKHRoaXMuX2NoYW5nZURlZmF1bHRUaW1lVmFsdWUuYmluZCh0aGlzKSksXHJcbiAgICAgICAgICAgIHRhcCgoKSA9PiB0aGlzLmlzVGltZVJhbmdlU2V0ICYmIHRoaXMuX3VwZGF0ZUF2YWlsYWJsZU1pbnV0ZXMoKSlcclxuICAgICAgICApIGFzIE9ic2VydmFibGU8Tmd4TWF0VGltZXBpY2tlckNsb2NrRmFjZT47XHJcbiAgICAgICAgdGhpcy5taW51dGUkID0gdGhpcy5fdGltZXBpY2tlclNlcnZpY2Uuc2VsZWN0ZWRNaW51dGUucGlwZShcclxuICAgICAgICAgICAgbWFwKHRoaXMuX2NoYW5nZURlZmF1bHRUaW1lVmFsdWUuYmluZCh0aGlzKSksXHJcbiAgICAgICAgICAgIHRhcCgoKSA9PiB0aGlzLl9pc0ZpcnN0VGltZUNoYW5nZSA9IGZhbHNlKVxyXG4gICAgICAgICkgYXMgT2JzZXJ2YWJsZTxOZ3hNYXRUaW1lcGlja2VyQ2xvY2tGYWNlPjtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZm9ybWF0ID09PSAxMikge1xyXG4gICAgICAgICAgICB0aGlzLl90aW1lcGlja2VyU2VydmljZS5zZWxlY3RlZFBlcmlvZC5waXBlKFxyXG4gICAgICAgICAgICAgICAgZGlzdGluY3RVbnRpbENoYW5nZWQ8Tmd4TWF0VGltZXBpY2tlclBlcmlvZHM+KCksXHJcbiAgICAgICAgICAgICAgICB0YXAoKHBlcmlvZDogTmd4TWF0VGltZXBpY2tlclBlcmlvZHMpID0+IHRoaXMucGVyaW9kID0gcGVyaW9kKSxcclxuICAgICAgICAgICAgICAgIHRhcChwZXJpb2QgPT4gdGhpcy5pc0NoYW5nZVBlcmlvZERpc2FibGVkID0gdGhpcy5faXNQZXJpb2REaXNhYmxlZChwZXJpb2QpKSxcclxuICAgICAgICAgICAgICAgIHRha2VVbnRpbCh0aGlzLl9zdWJzQ3RybCQpXHJcbiAgICAgICAgICAgICkuc3Vic2NyaWJlKCgpID0+IHRoaXMuaXNUaW1lUmFuZ2VTZXQgJiYgdGhpcy5fdXBkYXRlQXZhaWxhYmxlVGltZSgpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIG9uVGltZVNldCh0aW1lOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLl91cGRhdGVUaW1lKHRpbWUpO1xyXG4gICAgICAgIHRoaXMuX2VtaXRMb2NhbFRpbWVDaGFuZ2UodGltZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVnaXN0ZXJPbkNoYW5nZShmbjogYW55KTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5fb25DaGFuZ2UgPSBmbjtcclxuICAgIH1cclxuXHJcbiAgICByZWdpc3Rlck9uVG91Y2hlZChfZm5fOiBhbnkpOiB2b2lkIHtcclxuICAgIH1cclxuXHJcbiAgICBzZXREaXNhYmxlZFN0YXRlKGlzRGlzYWJsZWQ6IGJvb2xlYW4pOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmRpc2FibGVkID0gaXNEaXNhYmxlZDtcclxuICAgIH1cclxuXHJcbiAgICB3cml0ZVZhbHVlKHZhbDogc3RyaW5nKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHZhbCkge1xyXG4gICAgICAgICAgICB0aGlzLl9pbml0VGltZSh2YWwpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fcmVzZXRUaW1lKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX2NoYW5nZURlZmF1bHRUaW1lVmFsdWUoY2xvY2tGYWNlVGltZTogTmd4TWF0VGltZXBpY2tlckNsb2NrRmFjZSk6IE5neE1hdFRpbWVwaWNrZXJDbG9ja0ZhY2Uge1xyXG4gICAgICAgIGlmICghdGhpcy5faXNEZWZhdWx0VGltZSAmJiB0aGlzLl9pc0ZpcnN0VGltZUNoYW5nZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gey4uLmNsb2NrRmFjZVRpbWUsIHRpbWU6IG51bGx9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGNsb2NrRmFjZVRpbWU7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfY2hhbmdlVGltZSgpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCB0aW1lID0gdGhpcy5fdGltZXBpY2tlclNlcnZpY2UuZ2V0RnVsbFRpbWUodGhpcy5mb3JtYXQpO1xyXG4gICAgICAgIHRoaXMudGltZXBpY2tlclRpbWUgPSB0aW1lO1xyXG5cclxuICAgICAgICB0aGlzLl9lbWl0TG9jYWxUaW1lQ2hhbmdlKHRpbWUpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX2VtaXRMb2NhbFRpbWVDaGFuZ2UodGltZTogc3RyaW5nKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgbG9jYWxUaW1lID0gTmd4TWF0VGltZXBpY2tlckFkYXB0ZXIudG9Mb2NhbGVUaW1lU3RyaW5nKHRpbWUsIHtmb3JtYXQ6IHRoaXMuZm9ybWF0LCBsb2NhbGU6IHRoaXMuX2xvY2FsZX0pO1xyXG5cclxuICAgICAgICB0aGlzLl9vbkNoYW5nZShsb2NhbFRpbWUpO1xyXG4gICAgICAgIHRoaXMudGltZUNoYW5nZWQuZW1pdChsb2NhbFRpbWUpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX2luaXRUaW1lKHRpbWU6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IGlzRGVmYXVsdFRpbWVBdmFpbGFibGUgPSBOZ3hNYXRUaW1lcGlja2VyQWRhcHRlclxyXG4gICAgICAgICAgICAuaXNUaW1lQXZhaWxhYmxlKHRpbWUsIHRoaXMubWluIGFzIERhdGVUaW1lLCB0aGlzLm1heCBhcyBEYXRlVGltZSwgXCJtaW51dGVzXCIsIG51bGwsIHRoaXMuZm9ybWF0KTtcclxuICAgICAgICBpZiAoIWlzRGVmYXVsdFRpbWVBdmFpbGFibGUpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMubWluKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVUaW1lKE5neE1hdFRpbWVwaWNrZXJBZGFwdGVyLmZyb21EYXRlVGltZVRvU3RyaW5nKHRoaXMubWluIGFzIERhdGVUaW1lLCB0aGlzLmZvcm1hdCkpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5tYXgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVRpbWUoTmd4TWF0VGltZXBpY2tlckFkYXB0ZXIuZnJvbURhdGVUaW1lVG9TdHJpbmcodGhpcy5tYXggYXMgRGF0ZVRpbWUsIHRoaXMuZm9ybWF0KSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX3VwZGF0ZVRpbWUodGltZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfaXNQZXJpb2REaXNhYmxlZChwZXJpb2Q6IE5neE1hdFRpbWVwaWNrZXJQZXJpb2RzKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuIE5neE1hdFRpbWVwaWNrZXJVdGlscy5kaXNhYmxlSG91cnMoTmd4TWF0VGltZXBpY2tlclV0aWxzLmdldEhvdXJzKDEyKSwge1xyXG4gICAgICAgICAgICBtaW46IHRoaXMubWluIGFzIERhdGVUaW1lLFxyXG4gICAgICAgICAgICBtYXg6IHRoaXMubWF4IGFzIERhdGVUaW1lLFxyXG4gICAgICAgICAgICBmb3JtYXQ6IDEyLFxyXG4gICAgICAgICAgICBwZXJpb2Q6IHBlcmlvZCA9PT0gTmd4TWF0VGltZXBpY2tlclBlcmlvZHMuQU0gPyBOZ3hNYXRUaW1lcGlja2VyUGVyaW9kcy5QTSA6IE5neE1hdFRpbWVwaWNrZXJQZXJpb2RzLkFNXHJcbiAgICAgICAgfSkuZXZlcnkodGltZSA9PiB0aW1lLmRpc2FibGVkKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9vbkNoYW5nZTogKHZhbHVlOiBzdHJpbmcpID0+IHZvaWQgPSAoKSA9PiB7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfcmVzZXRUaW1lKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuX3RpbWVwaWNrZXJTZXJ2aWNlLmhvdXIgPSB7YW5nbGU6IDAsIHRpbWU6IG51bGx9O1xyXG4gICAgICAgIHRoaXMuX3RpbWVwaWNrZXJTZXJ2aWNlLm1pbnV0ZSA9IHthbmdsZTogMCwgdGltZTogbnVsbH07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfdXBkYXRlQXZhaWxhYmxlSG91cnMoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5ob3Vyc0xpc3QgPSBOZ3hNYXRUaW1lcGlja2VyVXRpbHMuZGlzYWJsZUhvdXJzKHRoaXMuaG91cnNMaXN0LCB7XHJcbiAgICAgICAgICAgIG1pbjogdGhpcy5taW4gYXMgRGF0ZVRpbWUsXHJcbiAgICAgICAgICAgIG1heDogdGhpcy5tYXggYXMgRGF0ZVRpbWUsXHJcbiAgICAgICAgICAgIGZvcm1hdDogdGhpcy5mb3JtYXQsXHJcbiAgICAgICAgICAgIHBlcmlvZDogdGhpcy5wZXJpb2RcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF91cGRhdGVBdmFpbGFibGVNaW51dGVzKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMubWludXRlc0xpc3QgPSBOZ3hNYXRUaW1lcGlja2VyVXRpbHMuZGlzYWJsZU1pbnV0ZXModGhpcy5taW51dGVzTGlzdCwgdGhpcy5fc2VsZWN0ZWRIb3VyLCB7XHJcbiAgICAgICAgICAgIG1pbjogdGhpcy5taW4gYXMgRGF0ZVRpbWUsXHJcbiAgICAgICAgICAgIG1heDogdGhpcy5tYXggYXMgRGF0ZVRpbWUsXHJcbiAgICAgICAgICAgIGZvcm1hdDogdGhpcy5mb3JtYXQsXHJcbiAgICAgICAgICAgIHBlcmlvZDogdGhpcy5wZXJpb2RcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF91cGRhdGVBdmFpbGFibGVUaW1lKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuX3VwZGF0ZUF2YWlsYWJsZUhvdXJzKCk7XHJcbiAgICAgICAgaWYgKHRoaXMuX3NlbGVjdGVkSG91cikge1xyXG4gICAgICAgICAgICB0aGlzLl91cGRhdGVBdmFpbGFibGVNaW51dGVzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX3VwZGF0ZVRpbWUodGltZTogc3RyaW5nKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRpbWUpIHtcclxuICAgICAgICAgICAgY29uc3QgZm9ybWF0dGVkVGltZSA9IE5neE1hdFRpbWVwaWNrZXJBZGFwdGVyLmZvcm1hdFRpbWUodGltZSwge2xvY2FsZTogdGhpcy5fbG9jYWxlLCBmb3JtYXQ6IHRoaXMuZm9ybWF0fSk7XHJcbiAgICAgICAgICAgIHRoaXMuX3RpbWVwaWNrZXJTZXJ2aWNlLnNldERlZmF1bHRUaW1lSWZBdmFpbGFibGUoZm9ybWF0dGVkVGltZSwgdGhpcy5taW4gYXMgRGF0ZVRpbWUsIHRoaXMubWF4IGFzIERhdGVUaW1lLCB0aGlzLmZvcm1hdCk7XHJcbiAgICAgICAgICAgIHRoaXMudGltZXBpY2tlclRpbWUgPSBmb3JtYXR0ZWRUaW1lO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn1cclxuIiwiPGRpdiBjbGFzcz1cIm5neC1tYXQtdGltZXBpY2tlclwiXHJcbiAgICAgW25nQ2xhc3NdPVwieyduZ3gtbWF0LXRpbWVwaWNrZXItLWRpc2FibGVkJzogZGlzYWJsZWR9XCI+XHJcbiAgICA8bmd4LW1hdC10aW1lcGlja2VyLXRpbWUtY29udHJvbFxyXG4gICAgICAgICAgICBjbGFzcz1cIm5neC1tYXQtdGltZXBpY2tlcl9fY29udHJvbC0tZmlyc3RcIlxyXG4gICAgICAgICAgICBbY29sb3JdPVwiY29sb3JcIlxyXG4gICAgICAgICAgICBbZmxvYXRMYWJlbF09XCJmbG9hdExhYmVsXCJcclxuICAgICAgICAgICAgW3BsYWNlaG9sZGVyXT1cIidISCdcIlxyXG4gICAgICAgICAgICBbdGltZV09XCIoaG91ciQgfCBhc3luYyk/LnRpbWVcIlxyXG4gICAgICAgICAgICBbbWluXT1cIm1pbkhvdXJcIlxyXG4gICAgICAgICAgICBbbWF4XT1cIm1heEhvdXJcIlxyXG4gICAgICAgICAgICBbdGltZVVuaXRdPVwidGltZVVuaXQuSE9VUlwiXHJcbiAgICAgICAgICAgIFtkaXNhYmxlZF09XCJkaXNhYmxlZFwiXHJcbiAgICAgICAgICAgIFt0aW1lTGlzdF09XCJob3Vyc0xpc3RcIlxyXG4gICAgICAgICAgICBbcHJldmVudFR5cGluZ109XCJpc1RpbWVSYW5nZVNldFwiXHJcbiAgICAgICAgICAgICh0aW1lQ2hhbmdlZCk9XCJjaGFuZ2VIb3VyKCRldmVudClcIj48L25neC1tYXQtdGltZXBpY2tlci10aW1lLWNvbnRyb2w+XHJcbiAgICA8c3BhbiBjbGFzcz1cInNlcGFyYXRvci1jb2xvbiBuZ3gtbWF0LXRpbWVwaWNrZXJfX2NvbnRyb2wtLXNlY29uZFwiPjo8L3NwYW4+XHJcbiAgICA8bmd4LW1hdC10aW1lcGlja2VyLXRpbWUtY29udHJvbFxyXG4gICAgICAgICAgICBjbGFzcz1cIm5neC1tYXQtdGltZXBpY2tlcl9fY29udHJvbC0tdGhpcmRcIlxyXG4gICAgICAgICAgICBbY29sb3JdPVwiY29sb3JcIlxyXG4gICAgICAgICAgICBbZmxvYXRMYWJlbF09XCJmbG9hdExhYmVsXCJcclxuICAgICAgICAgICAgW3BsYWNlaG9sZGVyXT1cIidNTSdcIlxyXG4gICAgICAgICAgICBbdGltZV09XCIobWludXRlJCB8IGFzeW5jKT8udGltZVwiXHJcbiAgICAgICAgICAgIFttaW5dPVwiMFwiXHJcbiAgICAgICAgICAgIFttYXhdPVwiNTlcIlxyXG4gICAgICAgICAgICBbdGltZVVuaXRdPVwidGltZVVuaXQuTUlOVVRFXCJcclxuICAgICAgICAgICAgW2Rpc2FibGVkXT1cImRpc2FibGVkXCJcclxuICAgICAgICAgICAgW3RpbWVMaXN0XT1cIm1pbnV0ZXNMaXN0XCJcclxuICAgICAgICAgICAgW3ByZXZlbnRUeXBpbmddPVwiaXNUaW1lUmFuZ2VTZXRcIlxyXG4gICAgICAgICAgICAodGltZUNoYW5nZWQpPVwiY2hhbmdlTWludXRlKCRldmVudClcIj48L25neC1tYXQtdGltZXBpY2tlci10aW1lLWNvbnRyb2w+XHJcbiAgICA8bWF0LWZvcm0tZmllbGQgY2xhc3M9XCJwZXJpb2Qtc2VsZWN0IG5neC1tYXQtdGltZXBpY2tlcl9fY29udHJvbC0tZm9ydGhcIlxyXG4gICAgICAgICAgICAgICAgICAgICpuZ0lmPVwiZm9ybWF0ICE9PSAyNFwiXHJcbiAgICAgICAgICAgICAgICAgICAgW2NvbG9yXT1cImNvbG9yXCI+XHJcbiAgICAgICAgPG1hdC1zZWxlY3QgW2Rpc2FibGVkXT1cImRpc2FibGVkIHx8IGlzQ2hhbmdlUGVyaW9kRGlzYWJsZWRcIlxyXG4gICAgICAgICAgICAgICAgICAgIChzZWxlY3Rpb25DaGFuZ2UpPVwiY2hhbmdlUGVyaW9kKCRldmVudClcIlxyXG4gICAgICAgICAgICAgICAgICAgIFtuZ01vZGVsXT1cInBlcmlvZFwiPlxyXG4gICAgICAgICAgICA8bWF0LW9wdGlvbiAqbmdGb3I9XCJsZXQgb3B0aW9uIG9mIHBlcmlvZHNcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBbdmFsdWVdPVwib3B0aW9uXCI+e3tvcHRpb259fTwvbWF0LW9wdGlvbj5cclxuICAgICAgICA8L21hdC1zZWxlY3Q+XHJcbiAgICA8L21hdC1mb3JtLWZpZWxkPlxyXG4gICAgPG5neC1tYXQtdGltZXBpY2tlci10b2dnbGVcclxuICAgICAgICAgICAgY2xhc3M9XCJuZ3gtbWF0LXRpbWVwaWNrZXJfX3RvZ2dsZVwiXHJcbiAgICAgICAgICAgICpuZ0lmPVwiIWNvbnRyb2xPbmx5XCJcclxuICAgICAgICAgICAgW2Zvcl09XCJ0aW1lcGlja2VyXCJcclxuICAgICAgICAgICAgW2Rpc2FibGVkXT1cImRpc2FibGVkXCI+XHJcbiAgICAgICAgPHNwYW4gbmd4TWF0VGltZXBpY2tlclRvZ2dsZUljb24+XHJcbiAgICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nVGVtcGxhdGVPdXRsZXQ9XCJ0b2dnbGVJY29uIHx8IGRlZmF1bHRJY29uXCI+PC9uZy1jb250YWluZXI+XHJcbiAgICAgICAgPC9zcGFuPlxyXG4gICAgPC9uZ3gtbWF0LXRpbWVwaWNrZXItdG9nZ2xlPlxyXG48L2Rpdj5cclxuPG5neC1tYXQtdGltZXBpY2tlclxyXG4gICAgICAgIFtjb2xvcl09XCJjb2xvclwiXHJcbiAgICAgICAgW21pbl09XCJtaW5cIlxyXG4gICAgICAgIFttYXhdPVwibWF4XCJcclxuICAgICAgICBbZGVmYXVsdFRpbWVdPVwidGltZXBpY2tlclRpbWVcIlxyXG4gICAgICAgIFtmb3JtYXRdPVwiZm9ybWF0XCJcclxuICAgICAgICBbY2FuY2VsQnRuVG1wbF09XCJjYW5jZWxCdG5UbXBsXCJcclxuICAgICAgICBbY29uZmlybUJ0blRtcGxdPVwiY29uZmlybUJ0blRtcGxcIlxyXG4gICAgICAgICh0aW1lU2V0KT1cIm9uVGltZVNldCgkZXZlbnQpXCJcclxuICAgICAgICAjdGltZXBpY2tlcj48L25neC1tYXQtdGltZXBpY2tlcj5cclxuXHJcbjxuZy10ZW1wbGF0ZSAjZGVmYXVsdEljb24+XHJcbiAgICA8bWF0LWljb24+d2F0Y2hfbGF0ZXI8L21hdC1pY29uPlxyXG48L25nLXRlbXBsYXRlPlxyXG4iXX0=