import { coerceBooleanProperty } from "@angular/cdk/coercion";
import { Component, EventEmitter, HostBinding, Input, Output } from "@angular/core";
import { NgxMatTimepickerAdapter } from "../../services/ngx-mat-timepicker-adapter";
import { NgxMatTimepickerDialogComponent } from "../ngx-mat-timepicker-dialog/ngx-mat-timepicker-dialog.component";
import { NGX_MAT_TIMEPICKER_CONFIG } from "../../tokens/ngx-mat-timepicker-config.token";
import { BehaviorSubject } from "rxjs";
import * as i0 from "@angular/core";
import * as i1 from "../../services/ngx-mat-timepicker-event.service";
import * as i2 from "@angular/material/dialog";
import * as i3 from "@angular/cdk/overlay";
import * as i4 from "../ngx-mat-timepicker-standalone/ngx-mat-timepicker-standalone.component";
let config;
export class NgxMatTimepickerComponent {
    constructor(_eventService, _dialog, _overlay) {
        this._eventService = _eventService;
        this._dialog = _dialog;
        this._overlay = _overlay;
        this.closed = new EventEmitter();
        this.hourSelected = new EventEmitter();
        this.hoursOnly = false;
        this.id = `ngx_mat_timepicker_${++NgxMatTimepickerComponent.nextId}`;
        this.isEsc = !0;
        this.opened = new EventEmitter();
        this.overlayPositions = [
            {
                originX: "center",
                originY: "bottom",
                overlayX: "center",
                overlayY: "top",
                offsetY: 0
            },
            {
                originX: "center",
                originY: "top",
                overlayX: "center",
                overlayY: "bottom",
                offsetY: 0
            }
        ];
        this.showPicker = !1;
        this.timeChanged = new EventEmitter();
        this.timeSet = new EventEmitter();
        this.timeUpdated = new BehaviorSubject(void 0); // used in the dialog, check if a better approach can be used
        this._appendToInput = !1;
        this._color = "primary";
        this._enableKeyboardInput = !1;
        this._format = 12;
    }
    set appendToInput(newValue) {
        this._appendToInput = coerceBooleanProperty(newValue);
    }
    set color(newValue) {
        this._color = newValue;
    }
    get color() {
        return this._color;
    }
    get disabled() {
        return this._timepickerInput && this._timepickerInput.disabled;
    }
    set enableKeyboardInput(newValue) {
        this._enableKeyboardInput = coerceBooleanProperty(newValue);
    }
    get enableKeyboardInput() {
        return this._enableKeyboardInput;
    }
    get format() {
        return this._timepickerInput ? this._timepickerInput.format : this._format;
    }
    set format(value) {
        this._format = NgxMatTimepickerAdapter.isTwentyFour(value) ? 24 : 12;
    }
    get inputElement() {
        return this._timepickerInput && this._timepickerInput.element;
    }
    get maxTime() {
        return this._timepickerInput ? this._timepickerInput.max : this.max;
    }
    get minTime() {
        return this._timepickerInput ? this._timepickerInput.min : this.min;
    }
    get minutesGap() {
        return this._minutesGap;
    }
    set minutesGap(gap) {
        if (gap == null) {
            return;
        }
        gap = Math.floor(gap);
        this._minutesGap = gap <= 59 ? gap : 1;
    }
    get overlayOrigin() {
        return this._timepickerInput ? this._timepickerInput.cdkOverlayOrigin : void 0;
    }
    get time() {
        return this._timepickerInput && this._timepickerInput.value;
    }
    close() {
        if (this._appendToInput) {
            this._overlayRef && this._overlayRef.dispose();
        }
        else {
            this._dialogRef && this._dialogRef.close();
        }
        this.showPicker = !1;
        this.closed.emit();
    }
    open() {
        // Set data to be injected
        config = {
            timepickerBaseRef: this,
            time: this.time,
            defaultTime: this.defaultTime,
            maxTime: this.maxTime,
            minTime: this.minTime,
            format: this.format,
            minutesGap: this.minutesGap,
            disableAnimation: this.disableAnimation,
            cancelBtnTmpl: this.cancelBtnTmpl,
            confirmBtnTmpl: this.confirmBtnTmpl,
            editableHintTmpl: this.editableHintTmpl,
            disabled: this.disabled,
            enableKeyboardInput: this.enableKeyboardInput,
            preventOverlayClick: this.preventOverlayClick,
            appendToInput: this._appendToInput,
            hoursOnly: this.hoursOnly,
            timepickerClass: this.timepickerClass,
            inputElement: this.inputElement,
            color: this.color
        };
        if (this._appendToInput) {
            this.showPicker = !0;
        }
        else {
            this._dialogRef = this._dialog.open(NgxMatTimepickerDialogComponent, {
                panelClass: "ngx-mat-timepicker-dialog",
                data: {
                    ...config
                }
            });
            this._dialogRef
                .afterClosed()
                .subscribe(() => {
                this.closed.emit();
            });
        }
        this.opened.emit();
    }
    /***
     * Register an input with this timepicker.
     * input - The timepicker input to register with this timepicker
     */
    registerInput(input) {
        if (this._timepickerInput) {
            console.warn("Input for this timepicker was already set", input.element);
            throw Error("A Timepicker can only be associated with a single input.");
        }
        this._timepickerInput = input;
    }
    unregisterInput() {
        this._timepickerInput = void 0;
    }
    updateTime(time) {
        this.timeUpdated.next(time);
    }
}
NgxMatTimepickerComponent.nextId = 0;
NgxMatTimepickerComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.0.1", ngImport: i0, type: NgxMatTimepickerComponent, deps: [{ token: i1.NgxMatTimepickerEventService }, { token: i2.MatDialog }, { token: i3.Overlay }], target: i0.ɵɵFactoryTarget.Component });
NgxMatTimepickerComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.0.1", type: NgxMatTimepickerComponent, selector: "ngx-mat-timepicker", inputs: { appendToInput: "appendToInput", color: "color", enableKeyboardInput: "enableKeyboardInput", format: "format", minutesGap: "minutesGap", cancelBtnTmpl: "cancelBtnTmpl", confirmBtnTmpl: "confirmBtnTmpl", defaultTime: "defaultTime", disableAnimation: "disableAnimation", editableHintTmpl: "editableHintTmpl", hoursOnly: "hoursOnly", isEsc: "isEsc", max: "max", min: "min", preventOverlayClick: "preventOverlayClick", timepickerClass: "timepickerClass" }, outputs: { closed: "closed", hourSelected: "hourSelected", opened: "opened", timeChanged: "timeChanged", timeSet: "timeSet" }, host: { properties: { "id": "this.id" } }, providers: [
        {
            provide: NGX_MAT_TIMEPICKER_CONFIG, useFactory() {
                return config;
            }
        }
    ], ngImport: i0, template: `
		<ng-template
				cdkConnectedOverlay
				[cdkConnectedOverlayPositions]="overlayPositions"
				[cdkConnectedOverlayHasBackdrop]="!0"
				cdkConnectedOverlayBackdropClass="cdk-overlay-transparent-backdrop"
				(backdropClick)="close()"
				[cdkConnectedOverlayOrigin]="overlayOrigin"
				[cdkConnectedOverlayOpen]="showPicker">
			<ngx-mat-timepicker-standalone></ngx-mat-timepicker-standalone>
		</ng-template>`, isInline: true, dependencies: [{ kind: "directive", type: i3.CdkConnectedOverlay, selector: "[cdk-connected-overlay], [connected-overlay], [cdkConnectedOverlay]", inputs: ["cdkConnectedOverlayOrigin", "cdkConnectedOverlayPositions", "cdkConnectedOverlayPositionStrategy", "cdkConnectedOverlayOffsetX", "cdkConnectedOverlayOffsetY", "cdkConnectedOverlayWidth", "cdkConnectedOverlayHeight", "cdkConnectedOverlayMinWidth", "cdkConnectedOverlayMinHeight", "cdkConnectedOverlayBackdropClass", "cdkConnectedOverlayPanelClass", "cdkConnectedOverlayViewportMargin", "cdkConnectedOverlayScrollStrategy", "cdkConnectedOverlayOpen", "cdkConnectedOverlayDisableClose", "cdkConnectedOverlayTransformOriginOn", "cdkConnectedOverlayHasBackdrop", "cdkConnectedOverlayLockPosition", "cdkConnectedOverlayFlexibleDimensions", "cdkConnectedOverlayGrowAfterOpen", "cdkConnectedOverlayPush"], outputs: ["backdropClick", "positionChange", "attach", "detach", "overlayKeydown", "overlayOutsideClick"], exportAs: ["cdkConnectedOverlay"] }, { kind: "component", type: i4.NgxMatTimepickerStandaloneComponent, selector: "ngx-mat-timepicker-standalone" }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.0.1", ngImport: i0, type: NgxMatTimepickerComponent, decorators: [{
            type: Component,
            args: [{
                    selector: "ngx-mat-timepicker",
                    template: `
		<ng-template
				cdkConnectedOverlay
				[cdkConnectedOverlayPositions]="overlayPositions"
				[cdkConnectedOverlayHasBackdrop]="!0"
				cdkConnectedOverlayBackdropClass="cdk-overlay-transparent-backdrop"
				(backdropClick)="close()"
				[cdkConnectedOverlayOrigin]="overlayOrigin"
				[cdkConnectedOverlayOpen]="showPicker">
			<ngx-mat-timepicker-standalone></ngx-mat-timepicker-standalone>
		</ng-template>`,
                    providers: [
                        {
                            provide: NGX_MAT_TIMEPICKER_CONFIG, useFactory() {
                                return config;
                            }
                        }
                    ]
                }]
        }], ctorParameters: function () { return [{ type: i1.NgxMatTimepickerEventService }, { type: i2.MatDialog }, { type: i3.Overlay }]; }, propDecorators: { appendToInput: [{
                type: Input
            }], color: [{
                type: Input
            }], enableKeyboardInput: [{
                type: Input
            }], format: [{
                type: Input
            }], minutesGap: [{
                type: Input
            }], cancelBtnTmpl: [{
                type: Input
            }], closed: [{
                type: Output
            }], confirmBtnTmpl: [{
                type: Input
            }], defaultTime: [{
                type: Input
            }], disableAnimation: [{
                type: Input
            }], editableHintTmpl: [{
                type: Input
            }], hourSelected: [{
                type: Output
            }], hoursOnly: [{
                type: Input
            }], id: [{
                type: HostBinding,
                args: ["id"]
            }], isEsc: [{
                type: Input
            }], max: [{
                type: Input
            }], min: [{
                type: Input
            }], opened: [{
                type: Output
            }], preventOverlayClick: [{
                type: Input
            }], timeChanged: [{
                type: Output
            }], timepickerClass: [{
                type: Input
            }], timeSet: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LW1hdC10aW1lcGlja2VyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1tYXQtdGltZXBpY2tlci9zcmMvbGliL2NvbXBvbmVudHMvbmd4LW1hdC10aW1lcGlja2VyL25neC1tYXQtdGltZXBpY2tlci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFDLHFCQUFxQixFQUFDLE1BQU0sdUJBQXVCLENBQUM7QUFDNUQsT0FBTyxFQUFDLFNBQVMsRUFBRSxZQUFZLEVBQUUsV0FBVyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQWMsTUFBTSxlQUFlLENBQUM7QUFPL0YsT0FBTyxFQUFDLHVCQUF1QixFQUFDLE1BQU0sMkNBQTJDLENBQUM7QUFJbEYsT0FBTyxFQUFDLCtCQUErQixFQUFDLE1BQU0sa0VBQWtFLENBQUM7QUFDakgsT0FBTyxFQUFDLHlCQUF5QixFQUFDLE1BQU0sOENBQThDLENBQUM7QUFHdkYsT0FBTyxFQUFDLGVBQWUsRUFBQyxNQUFNLE1BQU0sQ0FBQzs7Ozs7O0FBRXJDLElBQUksTUFBOEIsQ0FBQztBQXVCbkMsTUFBTSxPQUFPLHlCQUF5QjtJQXNIbEMsWUFBb0IsYUFBMkMsRUFDM0MsT0FBa0IsRUFDbEIsUUFBaUI7UUFGakIsa0JBQWEsR0FBYixhQUFhLENBQThCO1FBQzNDLFlBQU8sR0FBUCxPQUFPLENBQVc7UUFDbEIsYUFBUSxHQUFSLFFBQVEsQ0FBUztRQTlDM0IsV0FBTSxHQUFHLElBQUksWUFBWSxFQUFRLENBQUM7UUFLbEMsaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBVSxDQUFDO1FBQzNDLGNBQVMsR0FBRyxLQUFLLENBQUM7UUFDUixPQUFFLEdBQVcsc0JBQXNCLEVBQUUseUJBQXlCLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDbEYsVUFBSyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBR1YsV0FBTSxHQUFHLElB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QWpCLEtBQUs7Z0JBQ2EsRUFBRTtzQkFBcEIsV0FBVzt1QkFBQyxJQUFJO2dCQUNSLEtBQUs7c0JBQWIsS0FBSztnQkFDRyxHQUFHO3NCQUFYLEtBQUs7Z0JBQ0csR0FBRztzQkFBWCxLQUFLO2dCQUNJLE1BQU07c0JBQWYsTUFBTTtnQkFpQkUsbUJBQW1CO3NCQUEzQixLQUFLO2dCQUVJLFdBQVc7c0JBQXBCLE1BQU07Z0JBQ0UsZUFBZTtzQkFBdkIsS0FBSztnQkFDSSxPQUFPO3NCQUFoQixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtjb2VyY2VCb29sZWFuUHJvcGVydHl9IGZyb20gXCJAYW5ndWxhci9jZGsvY29lcmNpb25cIjtcclxuaW1wb3J0IHtDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSG9zdEJpbmRpbmcsIElucHV0LCBPdXRwdXQsIFRlbXBsYXRlUmVmfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xyXG5pbXBvcnQge0Nka092ZXJsYXlPcmlnaW4sIENvbm5lY3RlZFBvc2l0aW9uLCBPdmVybGF5LCBPdmVybGF5UmVmfSBmcm9tIFwiQGFuZ3VsYXIvY2RrL292ZXJsYXlcIjtcclxuaW1wb3J0IHtNYXREaWFsb2csIE1hdERpYWxvZ1JlZn0gZnJvbSBcIkBhbmd1bGFyL21hdGVyaWFsL2RpYWxvZ1wiO1xyXG5pbXBvcnQge1RoZW1lUGFsZXR0ZX0gZnJvbSBcIkBhbmd1bGFyL21hdGVyaWFsL2NvcmVcIjtcclxuLy9cclxuaW1wb3J0IHtOZ3hNYXRUaW1lcGlja2VyQ29uZmlnfSBmcm9tIFwiLi4vLi4vbW9kZWxzL25neC1tYXQtdGltZXBpY2tlci1jb25maWcuaW50ZXJmYWNlXCI7XHJcbmltcG9ydCB7Tmd4TWF0VGltZXBpY2tlckZvcm1hdFR5cGV9IGZyb20gXCIuLi8uLi9tb2RlbHMvbmd4LW1hdC10aW1lcGlja2VyLWZvcm1hdC50eXBlXCI7XHJcbmltcG9ydCB7Tmd4TWF0VGltZXBpY2tlckFkYXB0ZXJ9IGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9uZ3gtbWF0LXRpbWVwaWNrZXItYWRhcHRlclwiO1xyXG5pbXBvcnQge05neE1hdFRpbWVwaWNrZXJFdmVudFNlcnZpY2V9IGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9uZ3gtbWF0LXRpbWVwaWNrZXItZXZlbnQuc2VydmljZVwiO1xyXG5pbXBvcnQge05neE1hdFRpbWVwaWNrZXJEaXJlY3RpdmV9IGZyb20gXCIuLi8uLi9kaXJlY3RpdmVzL25neC1tYXQtdGltZXBpY2tlci5kaXJlY3RpdmVcIjtcclxuaW1wb3J0IHtOZ3hNYXRUaW1lcGlja2VyUmVmfSBmcm9tIFwiLi4vLi4vbW9kZWxzL25neC1tYXQtdGltZXBpY2tlci1yZWYuaW50ZXJmYWNlXCI7XHJcbmltcG9ydCB7Tmd4TWF0VGltZXBpY2tlckRpYWxvZ0NvbXBvbmVudH0gZnJvbSBcIi4uL25neC1tYXQtdGltZXBpY2tlci1kaWFsb2cvbmd4LW1hdC10aW1lcGlja2VyLWRpYWxvZy5jb21wb25lbnRcIjtcclxuaW1wb3J0IHtOR1hfTUFUX1RJTUVQSUNLRVJfQ09ORklHfSBmcm9tIFwiLi4vLi4vdG9rZW5zL25neC1tYXQtdGltZXBpY2tlci1jb25maWcudG9rZW5cIjtcclxuLy9cclxuaW1wb3J0IHtEYXRlVGltZX0gZnJvbSBcInRzLWx1eG9uXCI7XHJcbmltcG9ydCB7QmVoYXZpb3JTdWJqZWN0fSBmcm9tIFwicnhqc1wiO1xyXG5cclxubGV0IGNvbmZpZzogTmd4TWF0VGltZXBpY2tlckNvbmZpZztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6IFwibmd4LW1hdC10aW1lcGlja2VyXCIsXHJcbiAgICB0ZW1wbGF0ZTogYFxyXG5cdFx0PG5nLXRlbXBsYXRlXHJcblx0XHRcdFx0Y2RrQ29ubmVjdGVkT3ZlcmxheVxyXG5cdFx0XHRcdFtjZGtDb25uZWN0ZWRPdmVybGF5UG9zaXRpb25zXT1cIm92ZXJsYXlQb3NpdGlvbnNcIlxyXG5cdFx0XHRcdFtjZGtDb25uZWN0ZWRPdmVybGF5SGFzQmFja2Ryb3BdPVwiITBcIlxyXG5cdFx0XHRcdGNka0Nvbm5lY3RlZE92ZXJsYXlCYWNrZHJvcENsYXNzPVwiY2RrLW92ZXJsYXktdHJhbnNwYXJlbnQtYmFja2Ryb3BcIlxyXG5cdFx0XHRcdChiYWNrZHJvcENsaWNrKT1cImNsb3NlKClcIlxyXG5cdFx0XHRcdFtjZGtDb25uZWN0ZWRPdmVybGF5T3JpZ2luXT1cIm92ZXJsYXlPcmlnaW5cIlxyXG5cdFx0XHRcdFtjZGtDb25uZWN0ZWRPdmVybGF5T3Blbl09XCJzaG93UGlja2VyXCI+XHJcblx0XHRcdDxuZ3gtbWF0LXRpbWVwaWNrZXItc3RhbmRhbG9uZT48L25neC1tYXQtdGltZXBpY2tlci1zdGFuZGFsb25lPlxyXG5cdFx0PC9uZy10ZW1wbGF0ZT5gLFxyXG4gICAgcHJvdmlkZXJzOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBwcm92aWRlOiBOR1hfTUFUX1RJTUVQSUNLRVJfQ09ORklHLCB1c2VGYWN0b3J5KCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIF1cclxufSlcclxuZXhwb3J0IGNsYXNzIE5neE1hdFRpbWVwaWNrZXJDb21wb25lbnQgaW1wbGVtZW50cyBOZ3hNYXRUaW1lcGlja2VyUmVmIHtcclxuXHJcbiAgICBzdGF0aWMgbmV4dElkOiBudW1iZXIgPSAwO1xyXG5cclxuICAgIEBJbnB1dCgpXHJcbiAgICBzZXQgYXBwZW5kVG9JbnB1dChuZXdWYWx1ZTogYm9vbGVhbiB8IHN0cmluZyB8IHZvaWQpIHtcclxuICAgICAgICB0aGlzLl9hcHBlbmRUb0lucHV0ID0gY29lcmNlQm9vbGVhblByb3BlcnR5KG5ld1ZhbHVlKTtcclxuICAgIH1cclxuXHJcbiAgICBASW5wdXQoKVxyXG4gICAgc2V0IGNvbG9yKG5ld1ZhbHVlOiBUaGVtZVBhbGV0dGUpIHtcclxuICAgICAgICB0aGlzLl9jb2xvciA9IG5ld1ZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBjb2xvcigpOiBUaGVtZVBhbGV0dGUge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9jb2xvcjtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgZGlzYWJsZWQoKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RpbWVwaWNrZXJJbnB1dCAmJiB0aGlzLl90aW1lcGlja2VySW5wdXQuZGlzYWJsZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgQElucHV0KClcclxuICAgIHNldCBlbmFibGVLZXlib2FyZElucHV0KG5ld1ZhbHVlOiBib29sZWFuIHwgc3RyaW5nIHwgdm9pZCkge1xyXG4gICAgICAgIHRoaXMuX2VuYWJsZUtleWJvYXJkSW5wdXQgPSBjb2VyY2VCb29sZWFuUHJvcGVydHkobmV3VmFsdWUpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBlbmFibGVLZXlib2FyZElucHV0KCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9lbmFibGVLZXlib2FyZElucHV0O1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBmb3JtYXQoKTogTmd4TWF0VGltZXBpY2tlckZvcm1hdFR5cGUge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl90aW1lcGlja2VySW5wdXQgPyB0aGlzLl90aW1lcGlja2VySW5wdXQuZm9ybWF0IDogdGhpcy5fZm9ybWF0O1xyXG4gICAgfVxyXG5cclxuICAgIEBJbnB1dCgpXHJcbiAgICBzZXQgZm9ybWF0KHZhbHVlOiBOZ3hNYXRUaW1lcGlja2VyRm9ybWF0VHlwZSkge1xyXG4gICAgICAgIHRoaXMuX2Zvcm1hdCA9IE5neE1hdFRpbWVwaWNrZXJBZGFwdGVyLmlzVHdlbnR5Rm91cih2YWx1ZSkgPyAyNCA6IDEyO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBpbnB1dEVsZW1lbnQoKTogSFRNTEVsZW1lbnQge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl90aW1lcGlja2VySW5wdXQgJiYgdGhpcy5fdGltZXBpY2tlcklucHV0LmVsZW1lbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IG1heFRpbWUoKTogRGF0ZVRpbWUge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl90aW1lcGlja2VySW5wdXQgPyAodGhpcy5fdGltZXBpY2tlcklucHV0Lm1heCBhcyBEYXRlVGltZSkgOiB0aGlzLm1heDtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgbWluVGltZSgpOiBEYXRlVGltZSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RpbWVwaWNrZXJJbnB1dCA/ICh0aGlzLl90aW1lcGlja2VySW5wdXQubWluIGFzIERhdGVUaW1lKSA6IHRoaXMubWluO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBtaW51dGVzR2FwKCk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX21pbnV0ZXNHYXA7XHJcbiAgICB9XHJcblxyXG4gICAgQElucHV0KClcclxuICAgIHNldCBtaW51dGVzR2FwKGdhcDogbnVtYmVyKSB7XHJcbiAgICAgICAgaWYgKGdhcCA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZ2FwID0gTWF0aC5mbG9vcihnYXApO1xyXG4gICAgICAgIHRoaXMuX21pbnV0ZXNHYXAgPSBnYXAgPD0gNTkgPyBnYXAgOiAxO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBvdmVybGF5T3JpZ2luKCk6IENka092ZXJsYXlPcmlnaW4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl90aW1lcGlja2VySW5wdXQgPyB0aGlzLl90aW1lcGlja2VySW5wdXQuY2RrT3ZlcmxheU9yaWdpbiA6IHZvaWQgMDtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgdGltZSgpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl90aW1lcGlja2VySW5wdXQgJiYgdGhpcy5fdGltZXBpY2tlcklucHV0LnZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIEBJbnB1dCgpIGNhbmNlbEJ0blRtcGw6IFRlbXBsYXRlUmVmPE5vZGU+O1xyXG4gICAgQE91dHB1dCgpIGNsb3NlZCA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcclxuICAgIEBJbnB1dCgpIGNvbmZpcm1CdG5UbXBsOiBUZW1wbGF0ZVJlZjxOb2RlPjtcclxuICAgIEBJbnB1dCgpIGRlZmF1bHRUaW1lOiBzdHJpbmc7XHJcbiAgICBASW5wdXQoKSBkaXNhYmxlQW5pbWF0aW9uOiBib29sZWFuO1xyXG4gICAgQElucHV0KCkgZWRpdGFibGVIaW50VG1wbDogVGVtcGxhdGVSZWY8Tm9kZT47XHJcbiAgICBAT3V0cHV0KCkgaG91clNlbGVjdGVkID0gbmV3IEV2ZW50RW1pdHRlcjxudW1iZXI+KCk7XHJcbiAgICBASW5wdXQoKSBob3Vyc09ubHkgPSBmYWxzZTtcclxuICAgIEBIb3N0QmluZGluZyhcImlkXCIpIGlkOiBzdHJpbmcgPSBgbmd4X21hdF90aW1lcGlja2VyXyR7KytOZ3hNYXRUaW1lcGlja2VyQ29tcG9uZW50Lm5leHRJZH1gO1xyXG4gICAgQElucHV0KCkgaXNFc2MgPSAhMDtcclxuICAgIEBJbnB1dCgpIG1heDogRGF0ZVRpbWU7XHJcbiAgICBASW5wdXQoKSBtaW46IERhdGVUaW1lO1xyXG4gICAgQE91dHB1dCgpIG9wZW5lZCA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcclxuICAgIG92ZXJsYXlQb3NpdGlvbnM6IENvbm5lY3RlZFBvc2l0aW9uW10gPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBvcmlnaW5YOiBcImNlbnRlclwiLFxyXG4gICAgICAgICAgICBvcmlnaW5ZOiBcImJvdHRvbVwiLFxyXG4gICAgICAgICAgICBvdmVybGF5WDogXCJjZW50ZXJcIixcclxuICAgICAgICAgICAgb3ZlcmxheVk6IFwidG9wXCIsXHJcbiAgICAgICAgICAgIG9mZnNldFk6IDBcclxuICAgICAgICB9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgb3JpZ2luWDogXCJjZW50ZXJcIixcclxuICAgICAgICAgICAgb3JpZ2luWTogXCJ0b3BcIixcclxuICAgICAgICAgICAgb3ZlcmxheVg6IFwiY2VudGVyXCIsXHJcbiAgICAgICAgICAgIG92ZXJsYXlZOiBcImJvdHRvbVwiLFxyXG4gICAgICAgICAgICBvZmZzZXRZOiAwXHJcbiAgICAgICAgfVxyXG4gICAgXTtcclxuICAgIEBJbnB1dCgpIHByZXZlbnRPdmVybGF5Q2xpY2s6IGJvb2xlYW47XHJcbiAgICBzaG93UGlja2VyOiBib29sZWFuID0gITE7XHJcbiAgICBAT3V0cHV0KCkgdGltZUNoYW5nZWQgPSBuZXcgRXZlbnRFbWl0dGVyPHN0cmluZz4oKTtcclxuICAgIEBJbnB1dCgpIHRpbWVwaWNrZXJDbGFzczogc3RyaW5nO1xyXG4gICAgQE91dHB1dCgpIHRpbWVTZXQgPSBuZXcgRXZlbnRFbWl0dGVyPHN0cmluZz4oKTtcclxuICAgIHRpbWVVcGRhdGVkID0gbmV3IEJlaGF2aW9yU3ViamVjdDxzdHJpbmc+KHZvaWQgMCk7IC8vIHVzZWQgaW4gdGhlIGRpYWxvZywgY2hlY2sgaWYgYSBiZXR0ZXIgYXBwcm9hY2ggY2FuIGJlIHVzZWRcclxuXHJcbiAgICBwcml2YXRlIF9hcHBlbmRUb0lucHV0OiBib29sZWFuID0gITE7XHJcbiAgICBwcml2YXRlIF9jb2xvcjogVGhlbWVQYWxldHRlID0gXCJwcmltYXJ5XCI7XHJcbiAgICBwcml2YXRlIF9kaWFsb2dSZWY6IE1hdERpYWxvZ1JlZjxOZ3hNYXRUaW1lcGlja2VyRGlhbG9nQ29tcG9uZW50LCB2b2lkPjtcclxuICAgIHByaXZhdGUgX2VuYWJsZUtleWJvYXJkSW5wdXQ6IGJvb2xlYW4gPSAhMTtcclxuICAgIHByaXZhdGUgX2Zvcm1hdDogTmd4TWF0VGltZXBpY2tlckZvcm1hdFR5cGUgPSAxMjtcclxuICAgIHByaXZhdGUgX21pbnV0ZXNHYXA6IG51bWJlcjtcclxuICAgIHByaXZhdGUgX292ZXJsYXlSZWY6IE92ZXJsYXlSZWY7XHJcbiAgICBwcml2YXRlIF90aW1lcGlja2VySW5wdXQ6IE5neE1hdFRpbWVwaWNrZXJEaXJlY3RpdmU7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBfZXZlbnRTZXJ2aWNlOiBOZ3hNYXRUaW1lcGlja2VyRXZlbnRTZXJ2aWNlLFxyXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBfZGlhbG9nOiBNYXREaWFsb2csXHJcbiAgICAgICAgICAgICAgICBwcml2YXRlIF9vdmVybGF5OiBPdmVybGF5KSB7XHJcbiAgICB9XHJcblxyXG4gICAgY2xvc2UoKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2FwcGVuZFRvSW5wdXQpIHtcclxuICAgICAgICAgICAgdGhpcy5fb3ZlcmxheVJlZiAmJiB0aGlzLl9vdmVybGF5UmVmLmRpc3Bvc2UoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2RpYWxvZ1JlZiAmJiB0aGlzLl9kaWFsb2dSZWYuY2xvc2UoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zaG93UGlja2VyID0gITE7XHJcbiAgICAgICAgdGhpcy5jbG9zZWQuZW1pdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIG9wZW4oKTogdm9pZCB7XHJcbiAgICAgICAgLy8gU2V0IGRhdGEgdG8gYmUgaW5qZWN0ZWRcclxuICAgICAgICBjb25maWcgPSB7XHJcbiAgICAgICAgICAgIHRpbWVwaWNrZXJCYXNlUmVmOiB0aGlzLFxyXG4gICAgICAgICAgICB0aW1lOiB0aGlzLnRpbWUsXHJcbiAgICAgICAgICAgIGRlZmF1bHRUaW1lOiB0aGlzLmRlZmF1bHRUaW1lLFxyXG4gICAgICAgICAgICBtYXhUaW1lOiB0aGlzLm1heFRpbWUsXHJcbiAgICAgICAgICAgIG1pblRpbWU6IHRoaXMubWluVGltZSxcclxuICAgICAgICAgICAgZm9ybWF0OiB0aGlzLmZvcm1hdCxcclxuICAgICAgICAgICAgbWludXRlc0dhcDogdGhpcy5taW51dGVzR2FwLFxyXG4gICAgICAgICAgICBkaXNhYmxlQW5pbWF0aW9uOiB0aGlzLmRpc2FibGVBbmltYXRpb24sXHJcbiAgICAgICAgICAgIGNhbmNlbEJ0blRtcGw6IHRoaXMuY2FuY2VsQnRuVG1wbCxcclxuICAgICAgICAgICAgY29uZmlybUJ0blRtcGw6IHRoaXMuY29uZmlybUJ0blRtcGwsXHJcbiAgICAgICAgICAgIGVkaXRhYmxlSGludFRtcGw6IHRoaXMuZWRpdGFibGVIaW50VG1wbCxcclxuICAgICAgICAgICAgZGlzYWJsZWQ6IHRoaXMuZGlzYWJsZWQsXHJcbiAgICAgICAgICAgIGVuYWJsZUtleWJvYXJkSW5wdXQ6IHRoaXMuZW5hYmxlS2V5Ym9hcmRJbnB1dCxcclxuICAgICAgICAgICAgcHJldmVudE92ZXJsYXlDbGljazogdGhpcy5wcmV2ZW50T3ZlcmxheUNsaWNrLFxyXG4gICAgICAgICAgICBhcHBlbmRUb0lucHV0OiB0aGlzLl9hcHBlbmRUb0lucHV0LFxyXG4gICAgICAgICAgICBob3Vyc09ubHk6IHRoaXMuaG91cnNPbmx5LFxyXG4gICAgICAgICAgICB0aW1lcGlja2VyQ2xhc3M6IHRoaXMudGltZXBpY2tlckNsYXNzLFxyXG4gICAgICAgICAgICBpbnB1dEVsZW1lbnQ6IHRoaXMuaW5wdXRFbGVtZW50LFxyXG4gICAgICAgICAgICBjb2xvcjogdGhpcy5jb2xvclxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9hcHBlbmRUb0lucHV0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2hvd1BpY2tlciA9ICEwO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fZGlhbG9nUmVmID0gdGhpcy5fZGlhbG9nLm9wZW4oTmd4TWF0VGltZXBpY2tlckRpYWxvZ0NvbXBvbmVudCwge1xyXG4gICAgICAgICAgICAgICAgcGFuZWxDbGFzczogXCJuZ3gtbWF0LXRpbWVwaWNrZXItZGlhbG9nXCIsXHJcbiAgICAgICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgLi4uY29uZmlnXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB0aGlzLl9kaWFsb2dSZWZcclxuICAgICAgICAgICAgICAgIC5hZnRlckNsb3NlZCgpXHJcbiAgICAgICAgICAgICAgICAuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlZC5lbWl0KCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5vcGVuZWQuZW1pdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKipcclxuICAgICAqIFJlZ2lzdGVyIGFuIGlucHV0IHdpdGggdGhpcyB0aW1lcGlja2VyLlxyXG4gICAgICogaW5wdXQgLSBUaGUgdGltZXBpY2tlciBpbnB1dCB0byByZWdpc3RlciB3aXRoIHRoaXMgdGltZXBpY2tlclxyXG4gICAgICovXHJcbiAgICByZWdpc3RlcklucHV0KGlucHV0OiBOZ3hNYXRUaW1lcGlja2VyRGlyZWN0aXZlKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMuX3RpbWVwaWNrZXJJbnB1dCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLndhcm4oXCJJbnB1dCBmb3IgdGhpcyB0aW1lcGlja2VyIHdhcyBhbHJlYWR5IHNldFwiLCBpbnB1dC5lbGVtZW50KTtcclxuICAgICAgICAgICAgdGhyb3cgRXJyb3IoXCJBIFRpbWVwaWNrZXIgY2FuIG9ubHkgYmUgYXNzb2NpYXRlZCB3aXRoIGEgc2luZ2xlIGlucHV0LlwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fdGltZXBpY2tlcklucHV0ID0gaW5wdXQ7XHJcbiAgICB9XHJcblxyXG4gICAgdW5yZWdpc3RlcklucHV0KCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuX3RpbWVwaWNrZXJJbnB1dCA9IHZvaWQgMDtcclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVUaW1lKHRpbWU6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMudGltZVVwZGF0ZWQubmV4dCh0aW1lKTtcclxuICAgIH1cclxufVxyXG4iXX0=